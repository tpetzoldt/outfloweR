<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="outfloweR">
<title>Reservoir Mass Balance Simulation with Package `outfloweR` • outfloweR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Reservoir Mass Balance Simulation with Package `outfloweR`">
<meta property="og:description" content="outfloweR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">outfloweR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2-1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/outfloweR.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Reservoir Mass Balance Simulation with Package `outfloweR`</h1>
                        <h4 data-toc-skip class="author">Thomas
Petzoldt</h4>
            
            <h4 data-toc-skip class="date">2023-03-30</h4>
      
      
      <div class="d-none name"><code>outfloweR.Rmd</code></div>
    </div>

    
    
<!-- avoid border around images -->
<style>img {border: 0;}</style>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The package aims to demonstrate water management alternatives by
means of a simple mass balance model. Currently, the following state
variables and inputs are considered:</p>
<div class="section level3">
<h3 id="state-variables">State variables<a class="anchor" aria-label="anchor" href="#state-variables"></a>
</h3>
<ul>
<li>Volume of the mixed layer (<span class="math inline">\(V_E\)</span>), epilimnion in summer, total volume
otherwise)</li>
<li>Volume of the hypolimnion (<span class="math inline">\(V_H\)</span>)</li>
</ul>
<div class="section level4">
<h4 id="state-equations">State equations<a class="anchor" aria-label="anchor" href="#state-equations"></a>
</h4>
<p><span class="math display">\[\begin{align*}
\frac{dV_E}{dt} &amp;= Q_{in, E} - Q_{out, E} - Q_{out, wb, E} \\
\frac{dV_H}{dt} &amp;= Q_{in, H} - Q_{out, H} - Q_{out, wb, H}
\end{align*}\]</span></p>
<p>with:</p>
<p><span class="math display">\[
dV_E = dV_E + dV_H \qquad | \qquad V_H = 0
\]</span></p>
<p>The start time of summer stratification <span class="math inline">\(t_{strat}\)</span> can be set by the user. At this
time point, the total volume <span class="math inline">\(V\)</span> is
subdivided into an epilimnetic volume <span class="math inline">\(V_E =
V \cdot f_{epi}\)</span> and a hypolimnetic part <span class="math inline">\(V_H = V \cdot (1- f_{epi})\)</span>. The end of
summer stratification occurs when the hypolimnion is exhausted (<span class="math inline">\(V_H = 0\)</span>) or time exceeds fixed a
threshold (<span class="math inline">\(t_{autumn\)</span>), mimicking
thermal convection. This simple approach was intentionally chosen, even
if a full hydrophysical 1D model is also available.</p>
</div>
</div>
<div class="section level3">
<h3 id="inputs">Inputs<a class="anchor" aria-label="anchor" href="#inputs"></a>
</h3>
<ul>
<li>Considered are water inflow (<code>inflow</code>), outflow
(<code>outflow</code>) and wild bed outlet
(<code>outflow_wb</code>).</li>
<li>The water inflow can entrain to the epilimnion or the hypolimnion.
If a hypolimnion does not exist, hypolimnetic inflows are added to the
epilimnion.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="scenarios">Scenarios<a class="anchor" aria-label="anchor" href="#scenarios"></a>
</h2>
<p>Water inflow and abstraction can be controlled by pre-defined
scenarios, currently the following:</p>
<ul>
<li>standard: epilimnetic inflow, hypolimnetic outflows</li>
<li>cold_inflow: hypolimnetic inflow and outflows</li>
<li>wb_top: epilimnetic inflow, hypolimnetic drinking water abstraction,
wild bed outflow taken from epilimnion</li>
</ul>
<p>Further important settings are <code>vol</code>, the initial volume
of the reservoir and <code>t_strat</code> the time of stratification
onset. The parameter <code>t_autumn</code> specifies the latest end date
of stratificatiion by thermal convection, but stratification can also
occur earlier if the hypolimnion volume is exhausted.</p>
</div>
<div class="section level2">
<h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<div class="section level3">
<h3 id="series-1-realistic-time-series-with-balanced-inflow-and-outflow">Series 1: realistic time series with balanced inflow and
outflow<a class="anchor" aria-label="anchor" href="#series-1-realistic-time-series-with-balanced-inflow-and-outflow"></a>
</h3>
<p>The first example shows the standard example with the
<code>discharge_normal</code> example data set provided by the
package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st">"outfloweR"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"discharge_normal"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_flows.html">plot_flows</a></span><span class="op">(</span><span class="va">discharge_normal</span><span class="op">)</span></span></code></pre></div>
<p><img src="outfloweR_files/figure-html/unnamed-chunk-1-1.png" width="576"></p>
<p>As a first attempt, we assume that the inflow is rather cold, so that
it entrains to the hypolimnion. All outflows are also abstracted from
the bottom.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/scenario.html">scenario</a></span><span class="op">(</span><span class="st">"cold_inflow"</span>, vol<span class="op">=</span><span class="fl">60</span>, t_strat<span class="op">=</span><span class="fl">90</span>, t_autumn<span class="op">=</span><span class="fl">300</span>,</span>
<span>                <span class="va">discharge_normal</span><span class="op">$</span><span class="va">inflow</span>, <span class="va">discharge_normal</span><span class="op">$</span><span class="va">outflow</span>,</span>
<span>                <span class="va">discharge_normal</span><span class="op">$</span><span class="va">outflow_wb</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_volumes.html">plot_volumes</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span></code></pre></div>
<p><img src="outfloweR_files/figure-html/unnamed-chunk-2-1.png" width="720"></p>
<p>In the given data example, inflow and outflow data are well balanced,
so that the hypolimnion remains at an approximately constant level. This
is of course an approximation, ignoring further hydrophysical
processes.</p>
<p>Moreover, a cold hypolimnetic inflow is rarely observed in nature. In
most cases, the inflowing water entrains to the epi- or metalimnion. A
metalimnion is not considered here for simplicity, so we assume an
entrainment to the mixed layer.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/scenario.html">scenario</a></span><span class="op">(</span><span class="st">"standard"</span>, vol<span class="op">=</span><span class="fl">60</span>, t_strat<span class="op">=</span><span class="fl">90</span>, t_autumn<span class="op">=</span><span class="fl">300</span>,</span>
<span>                <span class="va">discharge_normal</span><span class="op">$</span><span class="va">inflow</span>, <span class="va">discharge_normal</span><span class="op">$</span><span class="va">outflow</span>,</span>
<span>                <span class="va">discharge_normal</span><span class="op">$</span><span class="va">outflow_wb</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_volumes.html">plot_volumes</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span></code></pre></div>
<p><img src="outfloweR_files/figure-html/unnamed-chunk-3-1.png" width="720"></p>
<p>We see that the hypolimnion is exhausted over the year.</p>
<p>The next example shows what happens if the wild bed outflow is
abstracted from the epilimnion:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/scenario.html">scenario</a></span><span class="op">(</span><span class="st">"wb_top"</span>, vol<span class="op">=</span><span class="fl">60</span>, t_strat<span class="op">=</span><span class="fl">90</span>, t_autumn<span class="op">=</span><span class="fl">300</span>,</span>
<span>                <span class="va">discharge_normal</span><span class="op">$</span><span class="va">inflow</span>, <span class="va">discharge_normal</span><span class="op">$</span><span class="va">outflow</span>,</span>
<span>                <span class="va">discharge_normal</span><span class="op">$</span><span class="va">outflow_wb</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_volumes.html">plot_volumes</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span></code></pre></div>
<p><img src="outfloweR_files/figure-html/unnamed-chunk-4-1.png" width="720"></p>
<p>We see that hypolimnetic volume can be saved, i.e. we have more
volume available volume for drinking water abstraction. This will also
have positive effects on water quality.</p>
</div>
<div class="section level3">
<h3 id="example-2-simplified-time-series-with-a-summer-flood">Example 2: Simplified time series with a summer flood<a class="anchor" aria-label="anchor" href="#example-2-simplified-time-series-with-a-summer-flood"></a>
</h3>
<p>Here we create an artifical inflow and outflow time series, where we
assume constant inflows and outflows, plus a summer flood event
generated from a log-lormal function. This leads to an increased total
volume, that is then subsequently removed from the dam.</p>
<p>The data creation is somewhat technical and is given here for full
reproducibility. It may be integrated as example data set in the package
at a later time.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://dplyr.tidyverse.org" class="external-link">"dplyr"</a></span><span class="op">)</span></span>
<span><span class="va">const_discharge</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  time <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">365</span>,</span>
<span>  inflow <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  outflow<span class="op">=</span><span class="fl">0.1</span>,</span>
<span>  outflow_wb<span class="op">=</span><span class="fl">0.12</span></span>
<span><span class="op">)</span></span>
<span><span class="va">time</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">365</span>; <span class="va">wave_start</span> <span class="op">&lt;-</span> <span class="fl">150</span>; <span class="va">yscale</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">wave</span> <span class="op">&lt;-</span> <span class="va">yscale</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">dlnorm</a></span><span class="op">(</span><span class="va">time</span> <span class="op">-</span> <span class="va">wave_start</span>, meanlog<span class="op">=</span><span class="fl">2</span>, sdlog<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">summer_flood</span> <span class="op">&lt;-</span> <span class="va">const_discharge</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>inflow <span class="op">=</span> <span class="va">inflow</span> <span class="op">+</span> <span class="va">wave</span>,</span>
<span>         outflow_wb <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">wave_start</span> <span class="op">+</span> <span class="fl">20</span> <span class="op">&lt;</span> <span class="va">time</span> <span class="op">&amp;</span> <span class="va">time</span> <span class="op">&lt;=</span> <span class="va">wave_start</span> <span class="op">+</span> <span class="fl">40</span>, <span class="va">outflow</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">wave</span><span class="op">)</span><span class="op">/</span><span class="fl">20</span>, <span class="va">outflow</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_flows.html">plot_flows</a></span><span class="op">(</span><span class="va">summer_flood</span><span class="op">)</span></span></code></pre></div>
<p><img src="outfloweR_files/figure-html/unnamed-chunk-5-1.png" width="576"></p>
<p>Now let’s compare the mass balance model with scnearios
<code>standard</code> (hypolimnetic wild bed) and <code>wb_top</code>
(wild bed abstraction from epilimnion):</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://rpkgs.datanovia.com/ggpubr/" class="external-link">"ggpubr"</a></span><span class="op">)</span></span>
<span><span class="va">out1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">summer_flood</span>,</span>
<span>            <span class="fu"><a href="../reference/scenario.html">scenario</a></span><span class="op">(</span><span class="st">"standard"</span>, vol<span class="op">=</span><span class="fl">60</span>, t_strat<span class="op">=</span><span class="fl">90</span>, t_autumn<span class="op">=</span><span class="fl">300</span>,</span>
<span>              <span class="va">inflow</span>, <span class="va">outflow</span>, <span class="va">outflow_wb</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">out2</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">summer_flood</span>,</span>
<span>              <span class="fu"><a href="../reference/scenario.html">scenario</a></span><span class="op">(</span><span class="st">"wb_top"</span>, vol<span class="op">=</span><span class="fl">60</span>, t_strat<span class="op">=</span><span class="fl">90</span>, t_autumn<span class="op">=</span><span class="fl">300</span>,</span>
<span>                       <span class="va">inflow</span>, <span class="va">outflow</span>, <span class="va">outflow_wb</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fig1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_volumes.html">plot_volumes</a></span><span class="op">(</span><span class="va">out1</span><span class="op">)</span></span>
<span><span class="va">fig2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_volumes.html">plot_volumes</a></span><span class="op">(</span><span class="va">out2</span><span class="op">)</span>                        </span>
<span><span class="fu">ggpubr</span><span class="fu">::</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span><span class="va">fig1</span>, <span class="va">fig2</span>, ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="outfloweR_files/figure-html/unnamed-chunk-6-1.png" width="576"></p>
<p>In result, we can clearly see the loss of hypolimnetic volume in the
standard scenario and the shorter stratification period (top figure) and
the extra hypolimnion volume gained in the second scenario, if wild bed
outled is taken from the epilimnetic layer.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Thomas Petzoldt, LuGu.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
